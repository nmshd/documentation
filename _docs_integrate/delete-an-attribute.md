---
# !!! Warning: Do not edit this file; any changes must be replicated in Excel !!!
permalink: integrate/delete-an-attribute
published: true
title: "Delete an Attribute"
type: scenario
toc: true
properties:
  - id: SC055
  - category: Handling data deletion
  - description:
  - customer: All
  - component: integrate
  - level: Advanced
  - implementation status: OPEN
  - documentation status: OPEN
  - published:
  - link: integrate/delete-an-attribute
require:
required_by:
---

The exact process of deleting a [LocalAttribute]({% link _docs_integrate/data-model-overview.md %}#localattribute) depends on the kind of LocalAttribute at hand.
Besides creating [IdentityAttributes]({% link _docs_integrate/data-model-overview.md %}#identityattribute) for yourself, a common usage of enmeshed is to share them with a peer or to receive shared Attributes from a peer.
These different cases have different demands that need to be taken into account, wanting to delete an Attribute.

In general, you can only delete data from your own wallet and never from the peer's.
So, you can delete peer shared Attributes, your copy of own shared Attributes and unshared RepositoryAttributes.
However, if you want the peer to delete an Attribute you shared with them, you will need to request it, since the peer may have a valid reason to still keep it for a certain amount of time.

## Request the deletion of own Attributes from peer

Wanting to delete an Attribute owned by you from the peer technically describes the endeavor of reverting sharing the Attribute with them.
To this end, a [Request]({% link _docs_integrate/data-model-overview.md %}#request) must be used with a [DeleteAttributeRequestItem]({% link _docs_integrate/data-model-overview.md %}#deleteattributerequestitem).
As a parameter, the `attributeId` of the shared Attribute you would like the peer to delete must be provided.
Note, that the peer shared Attribute at the peer's side has the same `id` like the own shared Attribute at your side.
A possible Request for deleting an Attribute could look as follows:

```json
{
  "@type": "Request",
  "items": [
    {
      "@type": "DeleteAttributeRequestItem",
      "mustBeAccepted": true,
      "attributeId": "<ID of shared LocalAttribute>"
    }
  ]
}
```

Of course, it is also possible to request the deletion of multiple shared Attributes within a single Request.
For this purpose, several DeleteAttributeRequestItems or suitable [RequestItemGroups]({% link _docs_integrate/data-model-overview.md %}#requestitemgroup) can be inserted into the `items` property of the Request.

Before sending the Request, we recommend to [validate its content]({% link _docs_use-cases/use-case-consumption-check-if-outgoing-request-can-be-created.md %}), since this will give you additional information in case of an error.
{: .notice--info}

Next, send the Request to the peer.
You can either do so by [Message]({% link _docs_integrate/data-model-overview.md %}#message) or by a [RelationshipTemplate]({% link _docs_integrate/data-model-overview.md %}#relationshiptemplate), using the `onExistingRelationship` property of a [RelationshipTemplateContent]({% link _docs_integrate/data-model-overview.md %}#relationshiptemplatecontent).
For a detailed explanation check out our guides on how to send [Requests via Messages]({% link _docs_integrate/requests-over-messages.md %}) and [Requests via RelationshipTemplates]({% link _docs_integrate/requests-over-templates.md %}).

Once the peer received the Request, they can accept or reject it.
If they want to [accept it]({% link _docs_use-cases/use-case-consumption-accept-incoming-request.md %}), they must use the [AcceptDeleteAttributeRequestItemParameters]({% link _docs_integrate/data-model-overview.md %}#acceptdeleteattributerequestitemparameters).
Doing so, they specify a `deletionDate` on which they plan to delete the Attribute.
In the given example, the payload would look like the following:

```json
{
  "items": [
    {
      "accept": true,
      "deletionDate": "<date the Attribute will be deleted>"
    }
  ]
}
```

Now, the [enmeshed Runtime]({% link _docs_explore/61-runtime.md %}) sets the `deletionInfo` of the corresponding peer shared Attributes of the peer with `deletionStatus` `"ToBeDeleted"` and the specified `deletionDate`.
Then, the appropriate [DeleteAttributeAcceptResponseItems]({% link _docs_integrate/data-model-overview.md %}#deleteattributeacceptresponseitem) are generated and send back in the [Reponse]({% link _docs_integrate/data-model-overview.md %}#response) to the Sender of the Request.
There, the `deletionInfo` of the corresponding own shared Attributes is set with `deletionStatus` `"ToBeDeletedByPeer"` and the `deletionDate` received in the Response.

It is also possible for the peer to [reject the Request]({% link _docs_use-cases/use-case-consumption-reject-incoming-request.md %}) for deleting Attributes as a whole, if they have a valid reason for keeping the Attributes.
In this case, it is advised to provide a `message` using the [RejectRequestItemParameters]({% link _docs_integrate/data-model-overview.md %}#rejectrequestitemparameters), informing the Sender of the Request about the reasons not to delete the Attributes.
{: .notice--info}

<!-- TODO: include diagram -->
<!-- ```plantuml
@startuml Request Deletion of Peer Shared Attribute [User Story]

title Request Deletion of Peer Shared Attribute [User Story]

participant "Attribute Owner" as owner
participant "Attribute Peer" as peer

group RequestDeletionOfPeerSharedAttribute Use Case
owner -> owner : validate request (own shared attributes only)
owner -> peer : send DeleteAttributeRequest item\n { "attributeId": "ATTdeadbeef1234" }
end group

group Accept Request
peer -> peer : mark peer shared attribute and all of its predecessors as\n{ "deletionStatus": { "status": "toBeDeleted", "deletionDate": "2024-01-01" }}
peer -> owner : Send DeleteAttributeRequest response\n { "deletionDate": "2024-01-01" }
end group

group Process Response
owner -> owner : mark own shared attribute and all of its predecessors as\n { "deletionStatus": { "status": "toBeDeletedByPeer", "deletionDate": 2024-01-01 }}
end group

@enduml
``` -->

## Delete peer shared Attributes

The actual deletion of a peer shared Attribute happens in a separate step.
This can either be triggered if the `deletionInfo.deletionDate` is reached, in case the deletion was requested by the owner of the Attribute, or if the peer decides they no longer need the shared Attribute.

To [delete a peer shared Attribute]({% link _docs_use-cases/use-case-consumption-delete-a-peer-shared-attribute-and-notify-peer.md %}) only its `attributeId` must be specified.
Internally, not just the given Attribute is deleted, but also all its predecessors, given there were any.
Moreover, if the Attribute had a successor, its `succeeds` property will be set to undefined, as the corresponding predecessor no longer exists.
Then, a [Notification]({% link _docs_integrate/data-model-overview.md %}#notification) with a [PeerSharedAttributeDeletedByPeerNotificationItem]({% link _docs_integrate/data-model-overview.md %}#peersharedattributedeletedbypeernotificationitem) is generated and sent to the owner of the Attribute, informing them that you deleted the Attribute they shared with you.
Consequently, the `deletionInfo` of their corresponding own shared Attribute and of all potential predecessors is updated with `deletionStatus` `"DeletedByPeer"` and the time of receiving the Notification as `deletionDate`.
If the Attribute has a successor, its `succeeds` property will be removed, too.
In case the owner already [deleted their own shared Attribute](#delete-own-shared-attributes), nothing happens.

<!-- TODO: implement adjustement of successor in NotificationItemProcessor -->

<!-- TODO: insert diagram -->

## Delete own shared Attributes

As owner of a shared Attribute, it is always possible to delete your shared Attribute copy.
Doing so before the [peer deleted their copy of the shared Attribute](#delete-peer-shared-attributes), however, you lose the information of having shared the Attribute with them and whether they keep your Attribute or delete it.
Thus, we recommend to [request the deletion of own Attributes from the peer](#request-the-deletion-of-own-attributes-from-peer) before deleting them yourself.

If you decide to [delete an own shared Attribute]({% link _docs_use-cases/use-case-consumption-delete-an-own-shared-attribute-and-notify-peer.md %}), you must specifiy its `attributeId`.
Then, in addition to the Attribute itself, also all its predecessors will be deleted, given there were any.
Moreover, if the Attribute had a successor, its `succeeds` property will be set to undefined, as the corresponding predecessor no longer exists.
Then, a Notification with an [OwnSharedAttributeDeletedByOwnerNotificationItem]({% link _docs_integrate/data-model-overview.md %}#ownsharedattributedeletedbyownernotificationitem) is generated and sent to the peer of the Attribute, informing them that you deleted the Attribute you shared with them.
If they already deleted their corresponding peer shared Attribute or marked it for deletion, nothing will change.
However, if the `deletionInfo` of their peer shared Attribute was undefined before, since you didn't send a Request for Attribute deletion or the Request was rejected, a `deletionInfo` will be set.
Its `deletionStatus` will be set to `"DeletedByOwner"` and the `deletionDate` will be the time of receiving the Notification.

<!-- TODO: insert diagram -->

## Delete RepositoryAttributes

Lastly, you can also [delete RepositoryAttributes]({% link _docs_use-cases/use-case-consumption-delete-a-repositoryattribute.md %}), i.e. own LocalAttributes without `shareInfo`.
Analogously to the cases above, also all predecessors of the Attribute with specified `attributeId` will be deleted and the `succeeds` property of the successor will be removed in case of [Attribute succession]({% link _docs_integrate/succeeding-attributes-to-update-their-values.md %}).

Furthermore, if there are any shared copies of the RepositoryAttribute, their `shareInfo` will be updated such that `sourceAttribute` doesn't link to the deleted RepositoryAttribute anymore.
As a consequence, the [get shared versions of a RepositoryAttribute use case]({% link _docs_use-cases/use-case-consumption-get-shared-versions-of-a-repositoryattribute.md %}) will no longer return those shared versions.
Now, in case you shared an Attribute with a peer, succeeded it without notifying the peer and delete the source Attribute of the predecessor, you won't be able to [notify the peer about the succession]({% link _docs_use-cases/use-case-consumption-notify-peer-about-repositoryattribute-succession.md %}) of this Attribute anymore.
Instead, if you want to inform them about a newer version of this Attribute, you must [share that version]({% link _docs_use-cases/use-case-consumption-share-a-repositoryattribute.md %}) again.
