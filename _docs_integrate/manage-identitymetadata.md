---
# Start automatic generation
permalink: integrate/manage-identitymetadata
published: true
title: "Manage IdentityMetadata"
type: scenario
toc: true
properties:
  - id: SC118
  - category: Identities and Relationships
  - description: Upsert, get and delete IdentityMetadata of the peers of Relationships or the own Identity
  - customer:
  - component: integrate
  - level:
  - implementation status: DONE
  - documentation status: DONE
  - published: true
  - link: manage-identitymetadata
require:
required_by:
# End automatic generation
---

An organization needs the option to easily store arbitrary auxiliary metadata about familiar persons for its self-administration.
This metadata must be [differentiated from the IdentityAttributes]({% link _docs_integrate/manage-identitymetadata.md %}#differentiation-from-identityattributes) provided by enmeshed, which are created for the purpose of exchanging with other [Identities]({% link _docs_integrate/data-model-overview.md %}#identity).
From a technical point of view, an Integrator of a Connector should be able to store metadata related to an Identity within the Connector.
The Identity about which metadata is to be stored must be sufficiently familiar to them, which means that it must be a `peer` of a [Relationship]({% link _docs_integrate/data-model-overview.md %}#relationship) or their own Identity.

For information on how to establish Relationships, refer to the [Establish Relationships]({% link _docs_integrate/establish-relationships.md %}) scenario documentation.
{: .notice--info}

# Storage of IdentityMetadata

Metadata about an [Identity]({% link _docs_integrate/data-model-overview.md %}#identity) is stored in a data object of type [IdentityMetadata]({% link _docs_integrate/data-model-overview.md %}#identitymetadata).
It has the properties `id`, `reference`, `key` and `value`.
It is possible to create or update IdentityMetadata about an Identity by proceeding as described in the [Upsert IdentityMetadata]({% link _docs_use-cases/use-case-consumption-upsert-identitymetadata.md %}) use case documentation and specifying its address as `reference` and the metadata to be stored as `value`.
If the referenced Identity is neither the own Identity nor a `peer` of a [Relationship]({% link _docs_integrate/data-model-overview.md %}#relationship) and is therefore not sufficiently familiar, an error with [error code]({% link _docs_integrate/error-codes.md %}) `error.runtime.identityMetadata.unfamiliarReferencedIdentity` is thrown.
The optional `key` property can be used as an additional identifier to store multiple IdentityMetadata about a single Identity.
If there is no IdentityMetadata for a given `reference` and `key` combination, a new IdentityMetadata will be created by the use case.
Otherwise, the existing IdentityMetadata is updated inplace with the new `value` provided.
Therefore, there can be at most one IdentityMetadata per `reference` and `key` combination.
In particular, there can be at most one IdentityMetadata without a `key` for each Identity.
For this reason, IdentityMetadata can be queried by specifying a combination of `reference` and `key` using the [Get IdentityMetadata]({% link _docs_use-cases/use-case-consumption-get-identitymetadata.md %}) use case with a uniquely determined return value.
If no matching IdentityMetadata can be found for the specified parameters, an error with error code `error.runtime.identityMetadata.notFound` is thrown.

# Removal of IdentityMetadata

If an Integrator of a Connector wants to delete IdentityMetadata manually, they must utilize the [Delete IdentityMetadata]({% link _docs_use-cases/use-case-consumption-delete-identitymetadata.md %}) use case providing the combination of `reference` and `key` of the IdentityMetadata to be deleted.
An error with [error code]({% link _docs_integrate/error-codes.md %}) `error.runtime.identityMetadata.notFound` is thrown if no matching IdentityMetadata can be found for the specified parameters.
When [decomposing a Relationship]({% link _docs_integrate/terminate-relationships.md %}#decompose-a-relationship), all IdentityMetadata that have the `peer` of the [Relationship]({% link _docs_integrate/data-model-overview.md %}#relationship) as their `reference` is deleted automatically.

# Differentiation from IdentityAttributes

In addition to the [IdentityMetadata]({% link _docs_integrate/data-model-overview.md %}#identitymetadata) presented in this guide, enmeshed provides [IdentityAttributes]({% link _docs_integrate/data-model-overview.md %}#identityattribute) for storing data of an [Identity]({% link _docs_integrate/data-model-overview.md %}#identity).
These two types of data objects are different from each other and are used for entirely different purposes.
In contrast to IdentityAttributes, IdentityMetadata can only be managed by Integrators of Connectors and not by App users.
This is because IdentityMetadata is intended as a separate option for Integrators of Connectors to store arbitrary auxiliary metadata of their peers.
IdentityAttributes are strongly interwoven into enmeshed and its features and the `value` of an IdentityAttribute is therefore more strictly typed.
The following table provides an overview of the differences between IdentityAttributes and IdentityMetadata.

| Aspect                                                                                                   | IdentityAttribute                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | IdentityMetadata                                                                                                                                                                                                                                                                                                                       |
| -------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Managing Identity                                                                                        | It can be managed by both an Integrator of a Connector or an App user.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | It can only be managed by an Integrator of a Connector.                                                                                                                                                                                                                                                                                |
| Possible types of `value`                                                                                | There is a predefined list of permitted [IdentityAttribute value types]({% link _docs_integrate/attribute-values.md %}#identity-attributes).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | It must only be compatible with the JSON data types `string`, `number`, `boolean`, `object`, `array` and `null`.                                                                                                                                                                                                                       |
| Kind of storage                                                                                          | Local storage within the `content` property of a [LocalAttribute]({% link _docs_integrate/data-model-overview.md %}#localattribute). The LocalAttribute can be identified by its `id`, which has `ATT` as prefix.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Local storage within an [IdentityMetadata]({% link _docs_integrate/data-model-overview.md %}#identitymetadata) data object. It can be identified by its `id`, which has `IDM` as prefix, or alternatively by its combination of `reference` and `key`.                                                                                 |
| Storability for own Identity                                                                             | Stored as a [RepositoryAttribute]({% link _docs_integrate/attribute-introduction.md %}#repositoryattributes). When [sharing a RepositoryAttribute]({% link _docs_use-cases/use-case-consumption-share-a-repositoryattribute.md %}), an [own shared IdentityAttribute]({% link _docs_integrate/attribute-introduction.md %}#own-shared-and-peer-shared-identityattributes) is created as a copy.                                                                                                                                                                                                                                                                                                                                                                                               | Stored as an [IdentityMetadata]({% link _docs_integrate/data-model-overview.md %}#identitymetadata) that has the `address` of the own [Identity]({% link _docs_integrate/data-model-overview.md %}#identity) as its `reference`.                                                                                                       |
| Storability for `peer` of [Relationship]({% link _docs_integrate/data-model-overview.md %}#relationship) | Stored as a [peer shared IdentityAttribute]({% link _docs_integrate/attribute-introduction.md %}#own-shared-and-peer-shared-identityattributes). Cannot be created manually, but is created automatically if the `peer` of the [Relationship]({% link _docs_integrate/data-model-overview.md %}#relationship) has [shared their RepositoryAttribute]({% link _docs_use-cases/use-case-consumption-share-a-repositoryattribute.md %}).                                                                                                                                                                                                                                                                                                                                                         | Stored as an [IdentityMetadata]({% link _docs_integrate/data-model-overview.md %}#identitymetadata) that has the `peer` of the [Relationship]({% link _docs_integrate/data-model-overview.md %}#relationship) as its `reference`.                                                                                                      |
| Set of features                                                                                          | Comprehensive feature set which, in addition to [creating]({% link _docs_integrate/create-attributes-for-yourself.md %}#create-an-identityattribute-for-yourself), [updating]({% link _docs_integrate/update-attributes-by-succession.md %}#succeeding-own-identityattributes), [getting]({% link _docs_use-cases/use-case-consumption-get-attribute.md %}) and [deleting]({% link _docs_integrate/delete-attributes.md %}) an IdentityAttribute, also includes [sharing with peer]({% link _docs_integrate/share-attributes-with-peer.md %}), [reading from peer]({% link _docs_integrate/read-attributes-from-peer.md %}), [creating for peer]({% link _docs_integrate/create-attributes-for-peer.md %}) and [proposing to peer]({% link _docs_integrate/propose-attributes-to-peer.md %}). | Minimal feature set that includes [creating and updating]({% link _docs_use-cases/use-case-consumption-upsert-identitymetadata.md %}), [getting]({% link _docs_use-cases/use-case-consumption-get-identitymetadata.md %}) and [deleting]({% link _docs_use-cases/use-case-consumption-delete-identitymetadata.md %}) IdentityMetadata. |
| Kind of update of `value`                                                                                | The `value` is [updated by succession]({% link _docs_integrate/update-attributes-by-succession.md %}#succeeding-own-identityattributes) and the history of changes is preserved.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | The `value` is [updated inplace]({% link _docs_use-cases/use-case-consumption-upsert-identitymetadata.md %}) and the history of changes is lost.                                                                                                                                                                                       |

# What's next?

As already mentioned in the section on the [differentiation from IdentityAttributes]({% link _docs_integrate/manage-identitymetadata.md %}#differentiation-from-identityattributes), [IdentityAttributes]({% link _docs_integrate/data-model-overview.md %}#identityattribute) are the classic means of choice provided by enmeshed to describe an [Identity]({% link _docs_integrate/data-model-overview.md %}#identity).
To find out more about IdentityAttributes and the options for managing them, the [IdentityAttribute introduction]({% link _docs_integrate/attribute-introduction.md %}#identityattributes) can be consulted.
