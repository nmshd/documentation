<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Migrate to v2 - Enmeshed</title>
<meta name="description" content="When migrating from v1 to v2, there are a few breaking changes, as well as a bunch of new features. This guide lists both of them and will help you migrate your integration coding.">


  <meta name="author" content="Enmeshed Team">
  
  <meta property="article:author" content="Enmeshed Team">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Enmeshed">
<meta property="og:title" content="Migrate to v2">
<meta property="og:url" content="/integrate/connector-migration-v2">


  <meta property="og:description" content="When migrating from v1 to v2, there are a few breaking changes, as well as a bunch of new features. This guide lists both of them and will help you migrate your integration coding.">







  <meta property="article:published_time" content="2023-04-21T11:03:15+02:00">






<link rel="canonical" href="/integrate/connector-migration-v2">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Enmeshed Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <link href="/assets/css/overwrite.css" rel="stylesheet" type="text/css" />

<!-- The following lines are needed because otherwise Prism (the syntax highlighter RapiDoc uses) breaks Rouge (the syntax highlighter we use) -->
<script>
    window.Prism = window.Prism || {};
    Prism.manual = true;
</script>
<script type="module" src="https://unpkg.com/rapidoc/dist/rapidoc-min.js"></script>



  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Enmeshed
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/use/basics">Use</a>
            </li><li class="masthead__menu-item">
              <a href="/explore">Explore</a>
            </li><li class="masthead__menu-item">
              <a href="/integrate">Integrate</a>
            </li><li class="masthead__menu-item">
              <a href="/contribute">Contribute</a>
            </li><li class="masthead__menu-item">
              <a href="/blog">Blog</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      <h3>Integrate Enmeshed</h3>
      
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Getting Started</span>
        

        
        <ul>
          
            <li><a href="/integrate/basics">Basics</a></li>
          
            <li><a href="/integrate/connector-tutorial">Connector Tutorial</a></li>
          
            <li><a href="/integrate/connector-modules">Connector Modules</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Setting up the Connector</span>
        

        
        <ul>
          
            <li><a href="/integrate/connector-installation">Installation</a></li>
          
            <li><a href="/integrate/connector-configuration">Configuration</a></li>
          
            <li><a href="/integrate/connector-setup-troubleshooting">Troubleshooting</a></li>
          
            <li><a href="/integrate/error-codes">Error Codes</a></li>
          
            <li><a href="/integrate/helm-chart">Helm Chart</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">REST API</span>
        

        
        <ul>
          
            <li><a href="/integrate/connector-api">API Documentation</a></li>
          
            <li><a href="/integrate/connector-flows-messages">Sending Messages</a></li>
          
            <li><a href="/integrate/requests-over-templates">Requests over Templates</a></li>
          
            <li><a href="/integrate/requests-over-messages">Requests over Messages</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Programming</span>
        

        
        <ul>
          
            <li><a href="/integrate/connector-sdks">Connector SDKs</a></li>
          
            <li><a href="/integrate/custom-connector-modules">Custom Connector Modules</a></li>
          
            <li><a href="/integrate/connector-events">Connector Events</a></li>
          
            <li><a href="/integrate/connector-migration-v2" class="active">Migrate to v2</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Operations</span>
        

        
        <ul>
          
            <li><a href="/integrate/connector-operations">Connector Operations</a></li>
          
            <li><a href="/integrate/connector-security">Security Considerations</a></li>
          
            <li><a href="/integrate/connector-privacy">Privacy Considerations</a></li>
          
            <li><a href="/integrate/connector-performance">Performance Considerations</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Data Model</span>
        

        
        <ul>
          
            <li><a href="/integrate/data-model-overview">Overview</a></li>
          
            <li><a href="/integrate/data-model-request-items">Request Items</a></li>
          
            <li><a href="/integrate/data-model-attribute-values">Attribute Values</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
    
  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Migrate to v2">
    <meta itemprop="description" content="When migrating from v1 to v2, there are a few breaking changes, as well as a bunch of new features. This guide lists both of them and will help you migrate your integration coding.">
    <meta itemprop="datePublished" content="2023-04-21T11:03:15+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="/integrate/connector-migration-v2" class="u-url" itemprop="url">Migrate to v2
</a>
          </h1>
          


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#backwards-incompatible-data-structure">Backwards incompatible data structure</a></li><li><a href="#common">Common</a><ul><li><a href="#http-route-prefix">HTTP route prefix</a></li><li><a href="#error-codes">Error codes</a></li></ul></li><li><a href="#attributes">Attributes</a></li><li><a href="#files">Files</a></li><li><a href="#messages">Messages</a></li><li><a href="#relationships">Relationships</a></li><li><a href="#relationship-templates">Relationship Templates</a></li><li><a href="#requests">Requests</a></li></ul>

            </nav>
          </aside>
        
        <p>When migrating from v1 to v2, there are a few breaking changes, as well as a bunch of new features. This guide lists both of them and will help you migrate your integration coding.</p>

<h2 id="backwards-incompatible-data-structure">Backwards incompatible data structure</h2>

<p>First and foremost, as we <a href="/blog/announcing-enmeshed-v2">already announced in our blog</a>, the underlying data structures of v2 are not compatible with the ones of v1 at all, and we are not planning to migrate any data. This means that before starting a v2 Connector, you need to make sure that the database is completely empty. You can achieve that e.g. by creating a new Docker volume for the MongoDB container or, if you host MongoDB outside of Docker, setting up a new MongoDB server. Of course, if you don’t have any important data, you can also delete database. This will ensure that on startup of the Connector, a new Enmeshed Identity is created. After that, you can start to migrate your integration coding to v2.</p>

<h2 id="common">Common</h2>

<p>There are two things that affect all HTTP routes: the route prefix and the error codes that are returned.</p>

<h3 id="http-route-prefix">HTTP route prefix</h3>

<p>The prefix of each route of the Connector’s HTTP API has changed from <code class="language-plaintext highlighter-rouge">/api/v1</code> to <code class="language-plaintext highlighter-rouge">/api/v2</code>. This means that you need to change all your API calls to the Connector to use the new prefix.</p>

<h3 id="error-codes">Error codes</h3>

<p>There are some error codes that have changed during our transition from v1 to v2. For a full list of error codes in v2, refer to <a href="/integrate/error-codes">the corresponding page</a>.</p>

<h2 id="attributes">Attributes</h2>

<p>With v2 of Enmeshed, Attributes were completely revamped. We won’t go into much detail here, but the following two paragraphs will give you links for further reading.</p>

<p><strong>Data Model</strong></p>

<p>You can find a description of Attributes in the <a href="/integrate/data-model-overview#attributes">data model</a>.</p>

<p><strong>Endpoints</strong></p>

<p>In order to manage Attributes with the Connector, the following endpoints exist (the endpoints listed below are interactive; feel free to execute them):
 <br /></p>

<rapi-doc-mini server-url="https://doc-demo.is.enmeshed.eu/" default-api-server="https://doc-demo.is.enmeshed.eu/" api-key-name="x-api-key" api-key-location="header" api-key-value="apikey" layout="column" default-schema-tab="example" spec-url="https://doc-demo.is.enmeshed.eu/docs/json" paths-expanded="false" theme="light" bg-color="#f9f9fb" match-paths="/api/v2/Attributes" match-type="regex"></rapi-doc-mini>
<p><br /></p>

<p class="notice--info">Tip: go through the new <a href="/integrate/connector-tutorial">Connector tutorial</a> if you want an example of how to create An Attribute.</p>

<h2 id="files">Files</h2>

<p>There are a few minor changes to the data model and the endpoints for managing Files.</p>

<p><strong>Data Model</strong></p>

<p>The following properties were removed from the <code class="language-plaintext highlighter-rouge">File</code> entity:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">deletedAt</code></li>
  <li><code class="language-plaintext highlighter-rouge">deletedBy</code></li>
  <li><code class="language-plaintext highlighter-rouge">deletedByDevice</code></li>
</ul>

<p>The reason for this is that these properties were added prematurely. At the moment it is not possible to delete files. This feature will be added in the future. But for now, we decided that the properties are misleading and removed them.</p>

<p>There also is a new property named <code class="language-plaintext highlighter-rouge">truncatedReference</code>, which is similar to the <code class="language-plaintext highlighter-rouge">truncatedReference</code> of a Token. It is a short reference to a File containing its ID and secret key. In order to share the File with a user, you can either send the <code class="language-plaintext highlighter-rouge">truncatedReference</code> as text, or - even simpler - create a QR code for it with the new endpoint(see table below). When the user scans this QR code with the Enmeshed app, the File is automatically downloaded - No Relationship necessary.</p>

<p><strong>Endpoints</strong></p>

<p>The following endpoints have changed:</p>

<table>
  <thead>
    <tr>
      <th>Route</th>
      <th>Change Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>POST /Files/Peer</td>
      <td>Updated</td>
      <td>You can now pass a <code class="language-plaintext highlighter-rouge">truncatedreference</code> of a File in the body of this endpoint. The other possibilities (id+secret key and a truncated Token reference) can still be used.</td>
    </tr>
    <tr>
      <td>GET /Files/{id}</td>
      <td>Updated</td>
      <td>You can now pass a <code class="language-plaintext highlighter-rouge">truncated reference</code> of a File as the route parameter <code class="language-plaintext highlighter-rouge">id</code> (or <code class="language-plaintext highlighter-rouge">idOrReference</code>, as it is called now) of this endpoint. Of course, you can still pass an ID.</td>
    </tr>
    <tr>
      <td>GET /Files/{id}</td>
      <td>Updated</td>
      <td>By setting the <code class="language-plaintext highlighter-rouge">Accept</code> HTTP header on this request to <code class="language-plaintext highlighter-rouge">image/png</code>, you can generate a QR code with the truncated File reference.</td>
    </tr>
  </tbody>
</table>

<h2 id="messages">Messages</h2>

<p>There are a few minor changes to the data model and the endpoints for managing Messages.</p>

<p><strong>Data Model</strong></p>

<p>The <a href="/integrate/data-model-overview#recipient">recipient</a> of a <code class="language-plaintext highlighter-rouge">Message</code> now has the property <code class="language-plaintext highlighter-rouge">relationshipId</code>, which contains the ID of the Relationship the Connector has to the recipient. This is useful for example if you want to query all Messages that belong to a specific Relationship.</p>

<p><strong>Endpoints</strong></p>

<p>The following endpoints have changed:</p>

<table>
  <thead>
    <tr>
      <th>Route</th>
      <th>Change Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>GET /Messages</td>
      <td>Updated</td>
      <td>As described above, there now is a <code class="language-plaintext highlighter-rouge">relationshipId</code> property on each object of the <code class="language-plaintext highlighter-rouge">recipients</code> array of a Message. You can use this property to filter for Messages of a specific Relationship by setting the query parameter <code class="language-plaintext highlighter-rouge">recipients.relationshipId</code> We further removed the query parameter <code class="language-plaintext highlighter-rouge">relationshipIds</code>, because it is not needed anymore.</td>
    </tr>
  </tbody>
</table>

<h2 id="relationships">Relationships</h2>

<p>There are a few minor changes to the data model and the endpoints for managing Relationships.</p>

<p><strong>Data Model</strong></p>

<p>The following properties were removed from the <code class="language-plaintext highlighter-rouge">Relationship</code> entity:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">lastMessageReceivedAt</code></li>
  <li><code class="language-plaintext highlighter-rouge">lastMessageSentAt</code></li>
</ul>

<p>These properties were never filled by the Runtime and were therefore removed. If you want for example the Relationships you sent a Message to in the last 24 hours, you can instead query the Messages and filter for the <code class="language-plaintext highlighter-rouge">createdAt</code> property in conjunction with createdBy set to your own Address. This gives you all the Messages you sent to in the last 24 hours. Now you just need to summarize the distinct <code class="language-plaintext highlighter-rouge">relationshipIds</code> of all these Messages. You can do similar to replace <code class="language-plaintext highlighter-rouge">lastMessageReceivedAt</code>.</p>

<p>Further, we removed two Relationship status:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Terminated</code>: Since we currently do not support termination of Relationships, we removed this status in order to reduce confusion.</li>
  <li><code class="language-plaintext highlighter-rouge">Revoked</code>: With the introduction of Requests, we had to temporarily remove the possibility of revoking Relationship Creation Changes, because if the Response sent with the Relationship Creation Change was already created by the peer, this Response would have to be deleted as soon as the Relationship Creation Change was revoked - which is really hard to implement. In the future, revoking Relationship Creation Changes will probably be possible again, but at the moment this is not our top priority.</li>
</ul>

<p><strong>Endpoints</strong></p>

<p>The following endpoints have changed:</p>

<table>
  <thead>
    <tr>
      <th>Route</th>
      <th>Change Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>PUT /Relationships/{id}/Changes/{changeId}/Revoke</td>
      <td>Removed</td>
      <td>As described above, we removed the <code class="language-plaintext highlighter-rouge">Revoked</code> status of a Relationship. Therefore we also removed the endpoint that was responsible for moving a Relationship to this status.</td>
    </tr>
    <tr>
      <td>GET /Relationships/{id}/Attributes</td>
      <td>Added</td>
      <td>This new route can be used to fetch all Attributes that exist in the context of the Relationship - so the ones you received from the peer as well as the ones you shared.</td>
    </tr>
  </tbody>
</table>

<h2 id="relationship-templates">Relationship Templates</h2>

<p>There are a few minor changes to the data model and the endpoints for managing Relationship Templates.</p>

<p><strong>Data Model</strong></p>

<p>The property <code class="language-plaintext highlighter-rouge">maxNumberOfRelationships</code> was removed from the <code class="language-plaintext highlighter-rouge">RelationshipTemplate</code> entity. It was replaced by the property <code class="language-plaintext highlighter-rouge">maxNumberOfAllocations</code> which offers similar functionality. The reason for this change is that with let’s say a <code class="language-plaintext highlighter-rouge">maxNumberOfRelationships</code> of 5, it was possible for 10 users to download the Relationship Template and fill it out. But finally, when trying to create the Relationship, 5 of them would receive an error message, because the maximum number of Relationships is exhausted. This is why the Relationship Template now has the property <code class="language-plaintext highlighter-rouge">maxNumberOfAllocations</code>. Setting this property to e.g. 5 will ensure that the Template can only be fetched by 5 different Identities. The sixth will receive an error message when trying to fetch it, so it won’t be able waste time by filling it out.</p>

<p>There also is a new property named <code class="language-plaintext highlighter-rouge">truncatedReference</code>, which is similar to the <code class="language-plaintext highlighter-rouge">truncatedReference</code> of a Token. It allows you to create a reference to a Relationship Template containing its ID and secret key. With this, there is no need to create a Token for a the Relationship Template anymore. Just create a QR code for the Relationship Template directly (see the new endpoint below). When the user scans this QR code with the Enmeshed app, the Relationship Template is downloaded and displayed.</p>

<p><strong>Endpoints</strong></p>

<p>The following endpoints have changed:</p>

<table>
  <thead>
    <tr>
      <th>Route</th>
      <th>Change Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>POST /RelationshipTemplates/Peer</td>
      <td>Updated</td>
      <td>You can now pass a <code class="language-plaintext highlighter-rouge">truncatedReference</code> of a Relationship Template in the body of this endpoint. The other possibilities (id+secret key and a truncated Token reference) can still be used.</td>
    </tr>
    <tr>
      <td>GET /RelationshipTemplates/{id}</td>
      <td>Updated</td>
      <td>By setting the <code class="language-plaintext highlighter-rouge">Accept</code> HTTP header on this request to <code class="language-plaintext highlighter-rouge">image/png</code>, you can generate a QR code with the <code class="language-plaintext highlighter-rouge">truncatedReference</code> of the Relationship Template.</td>
    </tr>
  </tbody>
</table>

<h2 id="requests">Requests</h2>

<p>With v2 of Enmeshed, there is the new concept of “Requests”, which are the new way to exchange Attributes between two Identities. And you can do a lot more with them. We won’t go into much detail here, but the following two paragraphs will give you links for further reading.</p>

<p><strong>Data Model</strong></p>

<p>You can find a description of Requests in the <a href="/integrate/data-model-overview#request">data model</a>. Further, there is a <a href="/integrate/data-model-request-items">dedicated page</a> where you can find all existing Request Items.</p>

<p><strong>Endpoints</strong></p>

<p>In order to manage Requests with the Connector, the following endpoints exist:
 <br /></p>

<rapi-doc-mini server-url="https://doc-demo.is.enmeshed.eu/" default-api-server="https://doc-demo.is.enmeshed.eu/" api-key-name="x-api-key" api-key-location="header" api-key-value="apikey" layout="column" default-schema-tab="example" spec-url="https://doc-demo.is.enmeshed.eu/docs/json" paths-expanded="false" theme="light" bg-color="#f9f9fb" match-paths="/api/v2/Requests" match-type="regex"></rapi-doc-mini>
<p><br /></p>

<p class="notice--info">Tip: go through the new <a href="/integrate/connector-tutorial">Connector tutorial</a> if you want an example of what you can do with Requests.</p>

        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2023-04-21T11:03:15+02:00">April 21, 2023</time></p>

      </footer>

      

      
  <nav class="pagination">
    
      <a href="/integrate/connector-performance" class="pagination--pager" title="Connector Performance Considerations
">Previous</a>
    
    
      <a href="/integrate/data-model-overview" class="pagination--pager" title="Enmeshed Data Model
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
    <ul class="social-icons">
           
        <li>
            <a href="/legal" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-info" aria-hidden="true"></i> Legal Disclosure</a>
        </li>
          
        <li>
            <a href="/privacy" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-user-shield" aria-hidden="true"></i> Privacy Statement</a>
        </li>
          
        <li>
            <a href="https://www.enmeshed.eu" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a>
        </li>
          
        <li>
            <a href="https://github.com/nmshd" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a>
        </li>
          
        <li>
            <a href="https://www.npmjs.com/search?q=%40nmshd" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-npm" aria-hidden="true"></i> NPM</a>
        </li>
           
        <li>
            <a href="/feed.xml"
                ><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a
            >
        </li>
        
    </ul>
</div>

<div class="page__footer-copyright">
    &copy; 2023
    <a href="https://www.js-soft.com">j&amp;s-soft GmbH</a>. Powered by
    <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.
</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
